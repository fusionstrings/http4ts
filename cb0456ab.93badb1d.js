(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{134:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return u}));var r=n(1),a=n(6),s=(n(0),n(143)),o={id:"testability",title:"Testability",sidebar_label:"Testability"},i={id:"welcome/testability",title:"Testability",description:"*Http4ts* abstracts the http related objects. Therefore, `Request` and `Response` are just simple objects with some methods that you can manipulate them safely in an immutable way. So, writing unit tests against handlers or filters is extremely simple. As an example, let's try to write some tests for the following handler:",source:"@site/docs/welcome/testability.md",permalink:"/docs/welcome/testability",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/welcome/testability.md",sidebar_label:"Testability",sidebar:"someSidebar",previous:{title:"Core Concepts",permalink:"/docs/welcome/core-concepts"},next:{title:"Runtime Independence",permalink:"/docs/welcome/runtime-independence"}},c=[],l={rightToc:c};function u(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(s.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(s.b)("p",null,Object(s.b)("em",{parentName:"p"},"Http4ts")," abstracts the http related objects. Therefore, ",Object(s.b)("inlineCode",{parentName:"p"},"Request")," and ",Object(s.b)("inlineCode",{parentName:"p"},"Response")," are just simple objects with some methods that you can manipulate them safely in an immutable way. So, writing unit tests against handlers or filters is extremely simple. As an example, let's try to write some tests for the following handler:"),Object(s.b)("pre",null,Object(s.b)("code",Object(r.a)({parentName:"pre"},{className:"language-ts"}),'const exampleUserInfo = {\n  firstName: "Jane",\n  lastName: "Doe"\n};\n\nasync function getUerProfileHandler(req: HttpRequest): Promise<HttpResponse> {\n  const authHeader = req.headers["authorization"] as string | undefined;\n  if (!authHeader) {\n    return res({ status: HttpStatus.UNAUTHORIZED });\n  }\n\n  const token = authHeader.toLowerCase().substring("bearer ".length);\n  if (token !== "valid-token") {\n    return res({ status: HttpStatus.UNAUTHORIZED });\n  }\n\n  return res({\n    status: HttpStatus.OK,\n    body: jsonBody(exampleUserInfo)\n  });\n}\n')),Object(s.b)("p",null,"This is an example handler that checks the validity of the token in ",Object(s.b)("inlineCode",{parentName:"p"},"Authorization")," header and returns ",Object(s.b)("inlineCode",{parentName:"p"},"OK")," with user info in the body when the token is valid. We can write the following tests for this handler (Tests are written in ",Object(s.b)("a",Object(r.a)({parentName:"p"},{href:"https://jestjs.io/"}),"Jest"),"):"),Object(s.b)("pre",null,Object(s.b)("code",Object(r.a)({parentName:"pre"},{className:"language-ts"}),'describe("loginHandler tests", () => {\n  it("should return unauthorized when request has no auth header", async () => {\n    const request = req("/", "GET", "", {});\n\n    const response = await loginUserHandler(request);\n\n    expect(response.status).toBe(HttpStatus.UNAUTHORIZED);\n  });\n\n  it("should return unauthorized when the token is not valid", async () => {\n    const headers = {\n      authorization: "bearer invalid-token"\n    };\n    const request = req("/", "GET", "", headers);\n\n    const response = await loginUserHandler(request);\n\n    expect(response.status).toBe(HttpStatus.UNAUTHORIZED);\n  });\n\n  it("should return ok with user info when the token is valid", async () => {\n    const headers = {\n      authorization: "bearer valid-token"\n    };\n    const request = req("/", "GET", "", headers);\n\n    const response = await loginUserHandler(request);\n\n    const expectedUserInfo = {\n      firstName: "Jane",\n      lastName: "Doe"\n    };\n\n    expect(response.status).toBe(HttpStatus.OK);\n    expect(response.body).toEqual(stringBody(JSON.stringify(expectedUserInfo)));\n  });\n});\n')),Object(s.b)("p",null,"As you can see in the tests, there is no special or framework specific preparation needed to write a tests. You can focus on the real business logic instead of writing lots of preparation code."))}u.isMDXComponent=!0},143:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var r=n(0),a=n.n(r);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),u=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i({},t,{},e)),n},p=function(e){var t=u(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},b=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,o=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=u(n),b=r,m=p["".concat(o,".").concat(b)]||p[b]||d[b]||s;return n?a.a.createElement(m,i({ref:t},l,{components:n})):a.a.createElement(m,i({ref:t},l))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=b;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var l=2;l<s;l++)o[l]=n[l];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);